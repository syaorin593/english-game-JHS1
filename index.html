<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>English Quest: JHS 1st Grade</title>
    <link rel="stylesheet" href="style.css">
    <meta property="og:title" content="English Quest: JHS 1st Grade">
    <meta property="og:description" content="中学1年生レベルの英語RPG。be動詞、一般動詞、can、現在進行形などを攻略せよ！">
    <meta property="og:type" content="game">
</head>
<body>
    <div id="app">
        <div id="version-display" style="position:absolute; bottom:5px; right:10px; font-size:0.7rem; color:#888; z-index:9999;">ver 1.0 (JHS1 Edition)</div>

        <div id="explanation-modal" class="modal-overlay hidden">
            <div class="modal-content explanation-box">
                <h3 class="text-danger">❌ Incorrect...</h3>
                <div class="correct-answer-display">
                    正解: <span id="expl-answer" class="text-success bold"></span>
                </div>
                <div class="explanation-text">
                    <p>【解説】</p>
                    <p id="expl-text"></p>
                </div>
                <button onclick="closeExplanation()" class="btn-primary">次へ進む ➡</button>
            </div>
        </div>

        <div id="endless-modal" class="modal-overlay hidden">
            <div class="modal-content">
                <h3>Check Point</h3>
                <p>10問クリア！HPが全回復しました。<br>さらに記録を伸ばしますか？</p>
                <div class="modal-buttons">
                    <button onclick="continueEndless()" class="btn-primary">続ける (+Bonus)</button>
                    <button onclick="finishGame(true)" class="btn-warning">記録して帰還</button>
                </div>
            </div>
        </div>

        <button id="debug-btn" class="hidden" onclick="toggleDebugMenu()">🛠️</button>
        <div id="debug-menu" class="hidden">
            <h3>Debug Menu</h3>
            <button onclick="debugUnlockAll()">全開放＆最強</button>
            <button onclick="debugReset()" style="background:#e74c3c;color:white;">データ完全消去</button>
            <button onclick="toggleDebugMenu()">閉じる</button>
        </div>

        <section id="screen-shop" class="screen hidden">
            <div class="header">
                <button class="back-btn" onclick="showScreen('screen-stages')">◀ 戻る</button>
                <h2>Item Shop</h2>
            </div>
            <div class="shop-status">
                所持ゴールド: <span id="shop-gold" class="gold-text">0 G</span>
            </div>
            <div class="shop-container">
                <div class="shop-item">
                    <div class="item-icon">💊</div>
                    <div class="item-info">
                        <div class="item-name">Potion</div>
                        <div class="item-desc">HPを1回復</div>
                        <div class="item-price">100 G</div>
                    </div>
                    <button onclick="buyItem('potion', 100)" class="btn-buy">購入</button>
                </div>
                <div class="shop-item">
                    <div class="item-icon">💣</div>
                    <div class="item-info">
                        <div class="item-name">Bomb</div>
                        <div class="item-desc">選択肢を2つ消去(4択のみ)</div>
                        <div class="item-price">150 G</div>
                    </div>
                    <button onclick="buyItem('bomb', 150)" class="btn-buy">購入</button>
                </div>
                <div class="shop-item">
                    <div class="item-icon">📜</div>
                    <div class="item-info">
                        <div class="item-name">Scroll</div>
                        <div class="item-desc">最初の単語入力＋頭文字</div>
                        <div class="item-price">200 G</div>
                    </div>
                    <button onclick="buyItem('hint', 200)" class="btn-buy">購入</button>
                </div>
                <div class="shop-item">
                    <div class="item-icon">✏️</div>
                    <div class="item-info">
                        <div class="item-name">Magic Pencil</div>
                        <div class="item-desc">記述を選択問題に変更</div>
                        <div class="item-price">300 G</div>
                    </div>
                    <button onclick="buyItem('pencil', 300)" class="btn-buy">購入</button>
                </div>
                <div class="shop-item">
                    <div class="item-icon">🛡️</div>
                    <div class="item-info">
                        <div class="item-name">Shield</div>
                        <div class="item-desc">ダメージを1回防ぐ</div>
                        <div class="item-price">250 G</div>
                    </div>
                    <button onclick="buyItem('shield', 250)" class="btn-buy">購入</button>
                </div>
                <div class="shop-item">
                    <div class="item-icon">🪙</div>
                    <div class="item-info">
                        <div class="item-name">Lucky Coin</div>
                        <div class="item-desc">クリア時獲得ゴールド2倍</div>
                        <div class="item-price">400 G</div>
                    </div>
                    <button onclick="buyItem('coin', 400)" class="btn-buy">購入</button>
                </div>
            </div>
            <div class="inventory-display">
                所持数: 
                💊<span id="inv-potion">0</span> 
                💣<span id="inv-bomb">0</span> 
                📜<span id="inv-hint">0</span> 
                ✏️<span id="inv-pencil">0</span> 
                🛡️<span id="inv-shield">0</span> 
                🪙<span id="inv-coin">0</span>
            </div>
        </section>

        <section id="screen-title" class="screen">
            <h1 id="game-title">ENGLISH QUEST</h1>
            <p class="subtitle">中学1年 英語完全攻略RPG</p>
            
            <p id="endless-record-display" class="hidden" style="color:#0984e3; font-weight:bold; margin-top:-10px;">Endless Best: 0 問</p>
            
            <div class="player-status-card">
                <div class="level-badge">Lv.<span id="title-level">1</span></div>
                <div class="exp-bar-container">
                    <div id="title-exp-bar" class="exp-bar-fill"></div>
                </div>
                <div style="font-size:0.8rem; margin-top:5px;">Next: <span id="title-next-exp">100</span> EXP</div>
            </div>

            <div class="menu-list">
                <button onclick="showScreen('screen-stages')" class="btn-primary">⚔️ 冒険に出る (Stages)</button>
                <button id="btn-endless" onclick="startEndless()" class="btn-warning locked">♾️ エンドレス (Locked)</button>
                <button onclick="showAchievements()" class="btn-info">🏆 称号・図鑑</button>
            </div>
        </section>

        <section id="screen-stages" class="screen hidden">
            <div class="header">
                <button class="back-btn" onclick="showScreen('screen-title')">◀ タイトル</button>
                <h2>Select Stage</h2>
            </div>
            <button onclick="showShop()" class="btn-shop">🛒 アイテムショップ (Gold: <span id="stage-gold">0</span>)</button>
            <div id="stage-list" class="grid-container"></div>
        </section>

        <section id="screen-game" class="screen hidden">
            <div id="boss-overlay" class="hidden">WARNING: BOSS BATTLE</div>
            <div id="shield-overlay" class="hidden">🛡️ SHIELD</div>
            <div id="coin-overlay" class="hidden">🪙 x2 BONUS</div>

            <div class="game-header">
                <button onclick="confirmQuit()" class="back-btn-mini">◀</button>
                <div class="status-center">
                    <div class="hp-container">
                        <span style="margin-right:5px;">HP</span>
                        <div class="hp-bar-bg"><div id="hp-bar-fill"></div></div>
                    </div>
                    <span id="score-display">Score: 0</span>
                </div>
            </div>
            <div id="progress-bar"><div id="progress-fill"></div></div>
            <div id="combo-popup" class="hidden"></div>

            <div id="question-area">
                <div id="q-category">Theme</div>
                <div id="q-type-badge">TYPE</div>
                <p id="q-text">Loading...</p>
                <div id="writing-status" class="hidden"></div>
                <div id="choices-container" class="hidden"></div>
                <div id="sort-container" class="hidden">
                    <div id="sort-answer-area"></div>
                    <div id="sort-options-area"></div>
                    <div class="sort-controls">
                        <button onclick="resetSort()" class="btn-small">リセット</button>
                    </div>
                </div>
                <div id="writing-container" class="hidden">
                    <p id="writing-hint" class="hint-text"></p>
                    <input type="text" id="writing-input" autocomplete="off" placeholder="答えを入力">
                    <button onclick="checkWritingAnswer()" class="btn-submit">回答する</button>
                </div>
            </div>

            <div id="item-use-area">
                <button id="btn-use-potion" class="btn-item" onclick="usePotion()">💊<br><span id="game-inv-potion">0</span></button>
                <button id="btn-use-bomb" class="btn-item" onclick="useBomb()">💣<br><span id="game-inv-bomb">0</span></button>
                <button id="btn-use-hint" class="btn-item" onclick="useHint()">📜<br><span id="game-inv-hint">0</span></button>
                <button id="btn-use-pencil" class="btn-item" onclick="usePencil()">✏️<br><span id="game-inv-pencil">0</span></button>
                <button id="btn-use-shield" class="btn-item" onclick="useShield()">🛡️<br><span id="game-inv-shield">0</span></button>
                <button id="btn-use-coin" class="btn-item" onclick="useCoin()">🪙<br><span id="game-inv-coin">0</span></button>
            </div>
        </section>

        <section id="screen-result" class="screen hidden">
            <h2 id="result-title">RESULT</h2>
            <div id="rank-badge"></div>
            <div id="result-stats"></div>
            <div class="exp-result-box">
                <div>獲得経験値: <span id="result-exp" class="bold text-success">+0 EXP</span></div>
                <div>獲得ゴールド: <span id="result-gold" class="bold text-gold">+0 G</span></div>
                <div class="exp-bar-container">
                    <div id="result-exp-bar" class="exp-bar-fill"></div>
                </div>
                <div id="levelup-msg" class="hidden">🆙 LEVEL UP!</div>
            </div>
            <div class="menu-list">
                <button onclick="retryGame()">もう一度挑戦</button>
                <button onclick="showScreen('screen-title')">タイトルへ</button>
                <button id="next-stage-btn" class="hidden btn-primary" onclick="nextStage()">次のステージへ ➡</button>
            </div>
        </section>

        <section id="screen-achievements" class="screen hidden">
            <div class="header">
                <button class="back-btn" onclick="showScreen('screen-title')">◀ 戻る</button>
                <h2>Achievements</h2>
            </div>
            <div id="achievement-stats"></div>
            <div id="achievement-list"></div>
        </section>
    </div>
    <script src="script.js"></script>
</body>
</html>
